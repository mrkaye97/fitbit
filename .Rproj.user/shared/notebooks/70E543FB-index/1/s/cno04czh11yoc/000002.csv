"0","df <- tbl(con, 'sleep') %>%"
"0","  arrange(date) %>%"
"0","  filter(mainSleep == 1) %>% # main sleep = no naps"
"0","  collect() %>%"
"0","  mutate(date = as_date(date),"
"0","         startTime = as_datetime(startTime),"
"0","         sh = ifelse(hour(startTime) < 8, hour(startTime) + 24, hour(startTime)), #create numeric times"
"0","         sm = minute(startTime),"
"0","         st = sh + sm/60,"
"0","         eh = hour(endTime),"
"0","         em = minute(endTime),"
"0","         et = eh + em/60,"
"0","         mst = ma(st, 7), #create moving averages"
"0","         met = ma(et, 7),"
"0","         year = year(startTime)"
"0","  )"
"0",""
"0","plt <- df %>%"
"0","    ggplot(aes(x = date))+"
"0","    geom_line(aes(y = et), color = 'coral', alpha = .3, na.rm = T)+"
"0","    geom_line(aes(y = st), color = 'dodgerblue', alpha = .3, na.rm = T)+"
"0","    geom_line(aes(y = met), color = 'coral', na.rm=T)+"
"0","    geom_line(aes(y = mst), color = 'dodgerblue', na.rm=T)+"
"0","    scale_y_continuous(breaks = seq(0, 30, 2),"
"0","                       labels = trans_format(function(x) ifelse(x > 23, x - 24, x), "
"0","                                             format = scales::comma_format(suffix = "":00"", accuracy = 1))"
"0","    )+"
"0","    labs(x = ""Date"","
"0","         y = 'Time')+"
"0","    theme_fivethirtyeight()+"
"0","  scale_x_date(date_breaks = '1 month', date_labels = '%b', expand = c(0, 0))+"
"0","  facet_grid(. ~ year, space = 'free', scales = 'free_x', switch = 'x') +"
"0","  theme(panel.spacing.x = unit(0,""line""), "
"0","        strip.placement = ""outside"")"
"0",""
"0","plt"
